{% extends "layouts/check-answers.njk" %}

{% set householdSize = log[section.id]["number-in-household"] | int %}

{% macro age (is_known, age) %}
{%- if is_known == "true" %}{{ age }}
{% elif is_known == "false" %}Not known
{% else %}<span class="app-!-colour-muted">You didn’t answer this question</span>
{% endif -%}
{% endmacro %}

{% block checkAnswers %}
  {{ rigSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    rows: [{
      key: {
        text: "Number of people in household"
      },
      value: {
        text: log[section.id]["number-in-household"] | textFromInputValue
      },
      actions: actionLinks({
        href: sectionPath + "/number-in-household",
        visuallyHiddenText: "number of people in household"
      }) if not log.submitted
    }]
  }) }}

  {% for i in range(1, householdSize + 1) %}
    {% set itemId = "lead-tenant" if i == 1 else "person-" + i %}
    {% set isLeadTenant = itemId == "lead-tenant" %}
    {% set isKnown = "true" %}
    {% if not isLeadTenant %}
      {% set isKnown = log[section.id][itemId + "-known"] == "true" %}
    {% endif %}
    {% set name = "lead tenant" if isLeadTenant else "person " + i %}

    {{ rigSummaryCard({
      classes: "govuk-!-margin-bottom-6",
      titleText: name | capitalize,
      rows: [{
        key: {
          text: "Details known"
        },
        value: {
          text: "Yes" if isKnown else "No"
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/known",
          visuallyHiddenText: "if details are known for " + name
        }) if not log.submitted
      } if not isLeadTenant, ({
        key: {
          text: "Relationship to lead tenant"
        },
        value: {
          text: log[section.id][itemId]["relationship-to-lead-tenant"] | textFromInputValue(data.questions["relationship-to-lead-tenant"])
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/relationship-to-lead-tenant",
          visuallyHiddenText: name + "’s relationship to lead tenant"
        }) if not log.submitted
      }  if not isLeadTenant) if isKnown, {
        key: {
          text: "Age"
        },
        value: {
          text: age(log[section.id][itemId]["age-known"], log[section.id][itemId]["age"])
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/age",
          visuallyHiddenText: name + "’s age"
        }) if not log.submitted
      } if isKnown, {
        key: {
          text: "Gender identity"
        },
        value: {
          text: log[section.id][itemId]["gender"] | textFromInputValue(data.questions["gender"])
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/gender",
          visuallyHiddenText: name + "’s gender identity"
        }) if not log.submitted
      } if isKnown, {
        key: {
          text: "Nationality"
        },
        value: {
          text: log[section.id][itemId]["nationality"] | textFromInputValue
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/nationality",
          visuallyHiddenText: name + "’s nationality"
        }) if not log.submitted
      } if isLeadTenant, {
        key: {
          text: "Working situation"
        },
        value: {
          text: log[section.id][itemId]["working-situation"] | textFromInputValue(data.questions["working-situation"])
        },
        actions: actionLinks({
          href: sectionPath + "/" + itemId + "/working-situation",
          visuallyHiddenText: name + "’s working situation"
        }) if not log.submitted
      } if isKnown]
    }) }}
  {% endfor %}
{% endblock %}
